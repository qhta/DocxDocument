namespace ModelGenApp.ViewModels;
public class NamespaceListViewModel: DispatchedCollection<NamespaceViewModel>
{
  public NamespaceListViewModel(PhaseViewModel phase, NTS nts, string? filter)
  {
    Phase = phase;
    var namespaces = TypeManager.GetNamespaces(nts).OrderBy(item=>item);
    foreach (var ns in namespaces)
    {
      var nsVM = new NamespaceViewModel(phase, ns );
      var nsTypes = TypeManager.GetNamespaceTypes(ns).OrderBy(item=>item.Name).ToList();
      if (filter!=null)
      {
        if (filter == SummaryInfoKind.AcceptedTypes.ToString())
          nsTypes = nsTypes.Where(item => item.IsAccepted).ToList();
        if (filter == SummaryInfoKind.RejectedTypes.ToString())
          nsTypes = nsTypes.Where(item => item.IsRejected).ToList();
        if (filter == SummaryInfoKind.InvalidTypes.ToString())
          nsTypes = nsTypes.Where(item => item.IsInvalid).ToList();
      }
      var nsTypesVM = nsTypes.Select(item=>new TypeInfoViewModel(item, nts.HasFlag(NTS.Origin))).ToList();
      nsVM.AllTypes.Items.AddRange(nsTypesVM);
      var nsClassesVM = nsTypes.Where(item=>item.TypeKind==TypeKind.Class)
        .Select(item=>new ClassInfoViewModel(item, nts.HasFlag(NTS.Origin))).ToList();
      nsVM.Classes.Items.AddRange(nsClassesVM);
      var nsEnumsVM = nsTypes.Where(item=>item.TypeKind==TypeKind.Enum)
        .Select(item=>new EnumTypeInfoViewModel(item, nts.HasFlag(NTS.Origin))).ToList();
      nsVM.Enums.Items.AddRange(nsEnumsVM);
      var nsInterfacesVM = nsTypes.Where(item=>item.TypeKind==TypeKind.Interface)
        .Select(item=>new ClassInfoViewModel(item, nts.HasFlag(NTS.Origin))).ToList();
      nsVM.Interfaces.Items.AddRange(nsInterfacesVM);
      var nsStructsVM = nsTypes.Where(item=>item.TypeKind==TypeKind.Struct)
        .Select(item=>new ClassInfoViewModel(item, nts.HasFlag(NTS.Origin))).ToList();
      nsVM.Structs.Items.AddRange(nsStructsVM);
      var nsOthersVM = nsTypesVM.Where(item=>item.TypeKind==TypeKind.Type).ToList();
      nsVM.Others.Items.AddRange(nsOthersVM);
      Add(nsVM);
    }
  }

  [DataGridColumn(IsAutoGenerated = false)]
  public PhaseViewModel Phase { get; private set; }

  [DataGridColumn(IsAutoGenerated = false)]
  public NTS Kind
  {
    get { return _Kind; }
    set
    {
      if (_Kind != value)
      {
        _Kind = value;
        NotifyPropertyChanged(nameof(Kind));
      }
    }
  }
  private NTS _Kind;

}
